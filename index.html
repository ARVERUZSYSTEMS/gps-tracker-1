// ===============================
// ARVERUZ GPS 3D - FUNCIONAL
// ===============================

// üîë PEGA TU TOKEN AQU√ç
Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyNmEyMDhlNi1lNGIyLTQ2M2QtYjg2Yy1jN2JkY2ZhNzk0YzAiLCJpZCI6MzkwOTAyLCJpYXQiOjE3NzExOTc5MDB9.WV9HjMr5oC93_gpe0dUA0QrQkjbM7R8OX9ihdK_n-ZY";

// Crear visor
const viewer = new Cesium.Viewer("cesiumContainer", {
    terrain: Cesium.Terrain.fromWorldTerrain(),
    timeline: false,
    animation: false
});

// Elementos HUD
const latElement = document.getElementById("lat");
const lonElement = document.getElementById("lon");
const altElement = document.getElementById("alt");
const accuracyElement = document.getElementById("accuracy");

// Marcador
let entity = viewer.entities.add({
    position: Cesium.Cartesian3.fromDegrees(0, 0, 0),
    point: {
        pixelSize: 10,
        color: Cesium.Color.RED
    }
});

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    }
}

function showPosition(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    const alt = position.coords.altitude || 0;
    const accuracy = position.coords.accuracy;

    latElement.textContent = lat.toFixed(6);
    lonElement.textContent = lon.toFixed(6);
    altElement.textContent = alt.toFixed(1);
    accuracyElement.textContent = accuracy.toFixed(1);

    const cartesian = Cesium.Cartesian3.fromDegrees(lon, lat, alt);
    entity.position = cartesian;

    viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(lon, lat, 1500),
        orientation: {
            pitch: Cesium.Math.toRadians(-45)
        }
    });
}

window.onload = function () {
    getLocation();
};
